<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <style>
    .counties {
      fill: none;
    }
    .states {
      fill: none;
      stroke: #fff;
      stroke-linejoin: round;
    }
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://d3js.org/d3-array.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo.v1.min.js"></script>
</head>
<body>

<svg width="960" height="600"></svg>

<script>
    var svg = d3.select("svg");
    svg.attr("preserveAspectRatio", "xMinYMin meet");
    svg.attr("width" ,window.innerWidth);
    svg.attr("height" ,window.innerHeight);


    d3.queue()
        .defer(d3.json, "/api/backend")
        .defer(d3.json, "map.json")
        .awaitAll(function(error, files) {
            ready(error, files[0], files[1]);
        });

    function cluster_to_colorscheme(cluster){
        for(key in cluster){

        }

    }

    function ready(error, clusters, map) {
      if (error) throw error;

      var projection = d3.geoEqualEarth();
      var outlines =  topojson.feature(
                map,
                map.objects["out"]).features;
      projection.fitSize([window.innerWidth, window.innerHeight], topojson.feature(
                map,
                map.objects["out"]));
      var path = d3.geoPath(projection);

      for(var feature in outlines){
        var state = outlines[feature].properties["iso_3166_2"];
        var fill = "#CCC";
        if(state in clusters){
            fill = "#F00";
        } else {
            if(state.split("-")[0] in clusters){
                fill = "#F00";
            }
        }
        svg.append("path")
            .attr("fill", fill)
            .attr("d", path(outlines[feature]));

      }
    }


    </script>
</body>